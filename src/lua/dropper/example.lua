-- ごちゃまぜドロップス用ドロッパ`スクリプトの述サンプル
-- 文字コ`ドは Shift_JIS で述してください
-- （※ただし、いわゆる「ダメ文字」策は特にしていません）
local P = {}

-- このドロッパ`の名前を指定します。
-- この名前はメニュ`アイテム名として利用されます。
P.name = "样品拖放器"

-- oninitmenu はメニュ`目を浃工毪郡幛撕簸肖欷蓼埂
function P.oninitmenu()
  -- メニュ`として表示すべき目名を文字列か、文字列の配列（テ`ブル）として返してください。
  -- nil を返した龊悉膝幞衰濠`目は表示されず、I理が呼び出されることもありません。
  -- 文字列を返した龊悉膝幞衰濠`目は１つのみで、それがクリックされると呼び出されます。
  -- 文字列の配列（テ`ブル）を返した龊悉膝单芝幞衰濠`として登hされます。
  -- このイベントはポップアップメニュ`表示の度に呼び出されるため、荷の高いI理を行うべきではありません。
  return nil
end

-- onselect はメニュ`目がxばれたrに呼ばれます。
function P.onselect(index, state)
  -- index にはxばれたメニュ`目の位置が整数で渡されます。
  --   サブメニュ`を持たないrは常に0、サブメニュ`を持つ龊悉1から始まるインデックスです。
  -- state には以下のようなテ`ブルを渡されます。
  --   state = {
  --     -- ファイルをドロップすべきマウスカ`ソル位置
  --     x=120,
  --     y=235,
  --     -- Hになるべきウィンドウのハンドル
  --     parent=123456
  --   }

  -- I理を行ったY果、ドロップするファイルが何もない龊悉 nil を返してください。
  return nil

  -- ファイルをドロップする龊悉膝榨ˉぅ胍挥Eとマウスなどの入力状Bを返す必要があります。
  -- イベントハンドラ`スクリプトで ondragenter に渡されてくる
  -- files と state と同じものをスクリプト内で作成し、I方を返してください。
  -- return files, state
  -- 
  -- 一r的なファイルを作成したい龊悉 GCMZDrops.createtempfile で作成するか、
  -- eの手段で作成したファイルを GCMZDrops.deleteonfinish で削除予sしてください。
  -- また、一r的なファイルを作成する龊悉 Temp フォルダ`を使用するのをく推Xします。
  -- それ以外の鏊だとユ`ザ`のO定次第でコピ`されるかどうかの振る舞いが浃铯辘蓼埂
  -- 一方、I理中に作成する一r的ではないファイルは
  -- 全てユ`ザ`がO定したフォルダ内におさまるように配置するのが望ましいです。
  -- それ以外の鏊に永A的なファイルを作成するスクリプトを作成する龊悉
  -- ユ`ザ`にコンセンサスを得た上で（※）行うようにしてください。
  -- ※ドキュメントなどにdする、GCMZDrops.confirm で_Jする、など
  --
  -- onselect g装rの注意点
  --   スクリプトのI理がLrgに渡る龊稀そのまま素直にスクリプトをg装すると
  --   メッセ`ジル`プが回らないのが原因で AviUtl 全体がフリ`ズします。
  --   Lua スクリプトで回数の多いル`プI理を行っているのが原因の龊悉
  --   GCMZDrops.doevents(0, 0) をたまに呼ぶことで回避可能ですが、
  --   os.execute を呼び出した龊悉胜嗓韦瑜ΔI理に介入できない龊悉
  --   Lua スクリプトだけでは}を回避することができません。
  --   この龊悉 Lua 用の DLL をe途作成することで回避できます。

  -- -- g装例
  -- -- "Hello world!" とかれたテキストファイルを作成し、集に投げzむ例
  -- local filepath = GCMZDrops.createtempfile("helloworld", ".txt")
  -- f, err = io.open(filepath, "wb")
  -- if f == nil then
  --   error(err)
  -- end
  -- f:write("Hello world!")
  -- f:close()
  -- return {{filepath=filepath}}, state
end

return P
