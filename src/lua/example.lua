-- ごちゃまぜドロップス用イベントハンドラ`スクリプトの述サンプル
-- 文字コ`ドは Shift_JIS で述してください
-- （※ただし、いわゆる「ダメ文字」策は特にしていません）
local P = {}

-- このハンドラ`の名前を指定します。
-- この名前はデバッグrに使用されます。
P.name = "样品句柄"

-- このハンドラ`のI理先度を整数で指定します。
-- ファイルをI理できるハンドラ`が}数ある龊悉恕が大きいほど先されます。
P.priority = 0

-- ondragenter はファイルやテキストをドラッグし、
-- 集ウィンドウ上にマウスが\った瞬gに呼ばれます。
function P.ondragenter(files, state)
  -- files にはドラッグされているアイテムが配列（テ`ブル）で渡されます。
  --
  --   [例1] エクスプロ`ラ`などからファイルがドロップされる龊
  --     files = {
  --       {filepath="C:\Your\File\First.png"},
  --       {filepath="C:\Your\File\Second.wav"}
  --     }
  --
  --     [a足情]
  --       エクスプロ`ラ`以外のソフトからファイルを掴んでいるrは
  --       filepath で示されたファイルがまだg在しないケ`スがあります。
  --       ondrop 以外でファイルの内容を参照したい龊悉
  --       ファイルが存在しなかったrの事も想定してI理をいてください。
  --
  --   [例2] Data URL scheme(RFC 2397) のテキストがドロップされる龊
  --     files = {
  --       {filepath="C:\Your\Image.png", mediatype="image/png"}
  --     }
  --
  --     [a足情]
  --       「data:text/plain,A%20brief%20note」のようなテキストを爝xkして
  --       集ウィンドウにドロップされたrのI理です。
  --       ブラウザからのドロップrにも使われることがあります。
  --       "data:,A%20brief%20note" のような龊悉 mediatype は空文字列です。
  --       ファイルの子は mediatype の内容に兢盲埔韵陇韦瑜ΔQ定されます。
  --       "text/plain" - *.txt
  --       "image/jpeg" - *.jpg
  --       "image/gif"  - *.gif
  --       "image/png"  - *.png
  --       "image/webp" - *.webp
  --       "image/bmp"  - *.bmp
  --       "audio/wav"  - *.wav
  --       それ以外     - *.bin
  --
  --   [例3] ブラウザやテキストエディタでxkしたテキストがドロップされる龊
  --     files = {
  --       {filepath="C:\Your\Text.txt", mediatype="text/plain; charset=Shift_JIS"}
  --     }
  --
  --     [a足情]
  --       テキストがドロップされる龊稀⒃のデ`タが Unicode だったとしても
  --       事前に Shift_JIS にQされ、常に同じ mediatype で渡されます。
  --
  --   [a足情]
  --     例1～3 でい菠郡猡韦悉搐沥悚蓼讥丧恁氓抓工伪咎澶ら渡される情螭扦工、
  --     自作したスクリプトにI理が回ってくるよりも先に
  --     textsjis.lua などeのスクリプトがg行されることにより、
  --     files 内のファイル情螭摔悉长长扦险h明されていない属性が追加されたり、
  --     ドロップされていないファイルが追加されていたりすることがあります。
  --
  --     それらの仕Mみに振り回されたくない龊悉
  --     先位をとても大きなにすることで回避できますが、
  --     状rによっては内容が同じファイルがいくつも作成されてしまうなど、
  --     本来意恧筏皮い婴菠欷皮筏蓼可能性もあるので注意が必要です。
  --
  -- state にはマウスとキ`ボ`ドにvする情螭テ`ブルで渡されます。
  --
  --   state = {
  --     x=123,
  --     y=168,
  --     control=false,
  --     shift=false,
  --     alt=false,
  --     lbutton=false,
  --     mbutton=false,
  --     rbutton=false
  --   }
  --
  --   [a足情]
  --     例えば Shift キ`を押したままドロップされたファイルだけに反辘筏郡龊悉扦狻
  --     ondragenter や ondragover のr点ではまだ Shift キ`が押されていないこともあります。
  --     そのrに return false してしまうと
  --     後Aの odragover や ondrop のrにハンドラ`が呼ばれないので注意が必要です。

  -- ファイルがI理できる、もしくはI理できそうな龊悉 true を返してください。
  return false
end

-- ondragover はファイルやテキストをドラッグしたまま、
-- 集ウィンドウ上でマウスが婴度に呼ばれます。
-- ただし ondragenter や ondragover で false を返していた龊悉虾簸肖欷蓼护蟆
function P.ondragover(files, state)
  -- files, state の内容は ondragenter と同じです。
  -- このイベントハンドラは高l度で呼ばれるため、重いI理は行わないでください。

  -- ファイルがI理できる、もしくはI理できそうな龊悉 true を返してください。
  return false
end

-- ondragleave はファイルやテキストをドラッグしているマウスカ`ソルが
-- 集ウィンドウ上からxれたrや、ドラッグ自体が中断されたrに呼ばれます。
-- ただし ondragenter や ondragover で false を返していた龊悉虾簸肖欷蓼护蟆
function P.ondragleave()
  -- りはありません。
end

-- ondrop はマウスボタンがxされ、ファイルがドロップされたrに呼ばれます。
-- ただし ondragenter や ondragover で false を返していた龊悉虾簸肖欷蓼护蟆
function P.ondrop(files, state)
  -- files, state の内容は ondragenter と同じです。

  -- ファイルをI理できなかった龊悉 false を返してください。
  -- false を返すとeのイベントハンドラ`にI理が移行します。
  return false

  -- I理中にユ`ザ`の操作によってキャンセルが要求された龊悉胜伞
  -- ファイルをI理せず、かつeのイベントハンドラ`もg行すべきでない龊悉
  -- nil を返すとI理を完全に中断することができます。
  -- return nil
  --
  -- I理できた龊悉膝榨ˉぅ胍挥Eとマウス位置を返してください。
  -- ドロップされたファイルをそのまま集ウィンドウにドロップする龊悉
  -- ondrop に渡された引数をそのまま渡せば全てドロップされます。
  -- return files, state
  --
  -- 自分でドロップするデ`タをMみ立てる龊悉弦韵陇虿慰激摔筏皮ださい。
  -- なお、I理中に作成／コピ`される一r的ではないファイルは
  -- 全てユ`ザ`がO定したフォルダ内におさまるように配置するのが望ましいです。
  -- それ以外の鏊に永A的なファイルを作成するスクリプトを作成する龊悉
  -- ユ`ザ`にコンセンサスを得た上で（※）行うようにしてください。
  -- ※ドキュメントなどにdする、GCMZDrops.confirm で_Jする、など
  --
  --   files には以下のような配列（テ`ブル）を指定します。
  --     files = {
  --       {filepath="C:\Your\File.png"},
  --       {filepath="C:\Your\File2.png"},
  --       ...
  --     }
  --  
  --     [a足情]
  --       files には配列（テ`ブル）で}数のファイルを指定できますが、
  --       １つのファイルによってタイムライン上に}数のアイテムが追加される龊稀
  --       そのファイル以降は正しくない位置にドロップされることがあります。
  --       （例えば *.exo や踊をドロップした龊悉税k生します）
  --  
  --   state には以下のようなテ`ブルを渡します。
  --     state = {
  --       -- ファイルをドロップするマウスカ`ソル位置
  --       x=120,
  --       y=235,
  --       -- ドロップI理後にMめる集カ`ソルのフレ`ム数
  --       -- ※通常のドロップではカ`ソルはovSな位置にあるため、指定する必要はありません
  --       frameadvance=0
  --     }
end

-- ごちゃまぜドロップス上の Lua では以下のv数やテ`ブルが使用可能です。
-- I理中には引数や状rに辘袱匹ē椹`がk生することがあり、それらは pcall で捕捉できます。
--
-- debug_print(str)
--
--   AviUtl 趣 Lua で使えるものと同じものです。
--   DebugView https://technet.microsoft.com/ja-jp/sysinternals/debugview.aspx
--   などを使うことで出力内容をリアルタイムに_Jすることができるため通しが良くなります。
--
--   [引数]
--     str にはデバッグ出力したい文字列を指定します。
--
--   [り]
--     りはありません。
--
-- scriptdir = GCMZDrops.scriptdir()
--
--   ごちゃまぜドロップス用のスクリプトファイルが格{されている
--   GCMZDrops フォルダ`の鏊を返します。
--
--   [り]
--     GCMZDrops フォルダ`の鏊を返します。
--     返されるパスの最後には必ず \ が付与されています。
--
-- filename = GCMZDrops.createfile(name, ext)
--
--   ごちゃまぜドロップスの保存用フォルダに
--   name のファイル名と ext の子を持つファイルを作成します。
--   作成されたファイルはI理中にスクリプトエラ`がk生したr、
--   およびドロップがキャンセルされたrは削除されます。
--
--   [引数]
--     name には作成したいファイルの名前を "foo" のような形で指定します。
--     ext には作成したいファイルの子を ".txt" のような形で指定します。
--     既に同じ名前のファイルが存在する龊悉胜嗓摔厦前は涓されることがあります。
--
--   [り]
--     filename には作成されたファイルの名前を返します。
--
-- filename = GCMZDrops.createtempfile(name, ext)
--
--   Windows の Temp フォルダに
--   name のファイル名と ext の子を持つファイルを作成します。
--   作成されたファイルはドロップI理のK了後に削除されます。
--
--   [引数]
--     name には作成したいファイルの名前を "foo" のような形で指定します。
--     ext には作成したいファイルの子を ".txt" のような形で指定します。
--     既に同じ名前のファイルが存在する龊悉胜嗓摔厦前は涓されることがあります。
--
--   [り]
--     filename には作成されたファイルの名前を返します。
--
-- files = GCMZDrops.findallfile(wildcard)
--
--   wildcard に一致するファイルを
--   ごちゃまぜドロップスの保存用フォルダの中から仕鳏筏蓼埂
--
--   [引数]
--     wildcard には{べたいファイル名を "foo.txt" のような形で指定します。
--     また "foo.*" のような指定をすると
--     "foo.txt" "foo.wav" などのファイルにヒットさせることができます。
--
--   [り]
--     files にはヒットしたファイル名が配列（テ`ブル）で返します。
--     ひとつもヒットしない龊悉仕飨去榨━毳扩`が存在しない龊悉峡栅违譬`ブルを返します。
--
-- r = GCMZDrops.englishpatched()
--
--   集が英Z化パッチが当たったものかどうかを返します。
--   英Z化されている龊 "*.exo" や "*.exa" の内容も涓が必要にあります。
--
--   [り]
--     英Z化パッチが当たっている龊悉 true を返します。
--
-- r = GCMZDrops.needcopy(filepath)
--
--   F在の「I理モ`ド」O定で filepath はコピ`が必要かどうかを返します。
--   コピ`が必要な鏊であってもファイルの子が
--   ".txt" ".exo" ".exa" のいずれかの龊悉 false を返します。
--
--   [引数]
--     filepath にはコピ`が必要かどうかを{べたいファイルを指定します。
--
--   [り]
--     r にはコピ`が必要かどうかを返します。
--
-- hash = GCMZDrops.calchash(hash, str)
--
--   str のハッシュを算します。
--
--   [引数]
--     hash には前回得られたハッシュを渡します。
--     一番最初の呼び出しのrは 0 を渡してください。
--
--     str にはハッシュを算したいデ`タを文字列として渡します。
--
--   [り]
--     hash には 64bit のハッシュを文字列として返します。
--
-- hash = GCMZDrops.calcfilehash(filepath)
--
--   filepath のハッシュを算します。
--
--   [引数]
--     filepath にはハッシュを算したいファイルパスを渡します。
--
--   [り]
--     hash には 64bit のハッシュを文字列として返します。
--
-- str = GCMZDrops.hashtostring(hash)
--
--   ハッシュをテキストで表F可能な形式にQします。
--
--   [引数]
--     hash には calchash/calcfilehash のりを渡してください。
--
--   [り]
--     str にはハッシュが base32 エンコ`ドされた文字列を返します。
--
-- fileinfo = GCMZDrops.getexeditfileinfo()
--
--   集で集しているプロジェクトにvする情螭蛉〉盲筏蓼埂
--
--   [り]
--     fileinfo には以下のようなテ`ブルを返します。
--     fileinfo = {
--       -- 踊の幅
--       width=1280,
--       -- 踊の高さ
--       height=720,
--       -- 踊のフレ`ムレ`ト(30fpsのrは30、59.97fpsのrは5997など)
--       rate=30,
--       -- 踊のフレ`ムレ`トのスケ`ル(30fpsのrは1、59.97fpsのrは100など)
--       scale=1,
--       -- 踊のtフレ`ム数
--       length=456,
--       -- 音声のサンプルレ`ト
--       audio_rate=48000,
--       -- 音声のチャンネル数
--       audio_ch=2
--     }
--
-- fileinfo = GCMZDrops.getfileinfo(filepath)
--
--   *.avi や *.wav などを AviUtl で_いて各N情螭蛉〉盲筏蓼埂
--   集でまだプロジェクトが_かれていない龊悉膝ē椹`がk生します。
--
--   [引数]
--     filepath には情螭蛉〉盲筏郡ぅ幞钎％ファイルへのパスを渡します。
--
--   [り]
--     fileinfo には以下のようなテ`ブルを返します。
--     fileinfo = {
--       -- 踊の幅
--       width=1280,
--       -- 踊の高さ
--       height=720,
--       -- 踊のフレ`ムレ`ト(30fpsのrは30、59.97fpsのrは5997など)
--       rate=30,
--       -- 踊のフレ`ムレ`トのスケ`ル(30fpsのrは1、59.97fpsのrは100など)
--       scale=1,
--       -- 踊のtフレ`ム数
--       length=456,
--       -- 音声のサンプルレ`ト
--       audio_rate=48000,
--       -- 音声のチャンネル数
--       audio_ch=2,
--       -- サンプルレ`トなどをプロジェクトに合わせた龊悉我羯のtサンプル数
--       audio_samples=123343
--     }
--
-- encstr = GCMZDrops.encodeexotext(str)
--
--   文字列を AviUtl の exo ファイルや exa ファイルで使われる
--   テキストオブジェクトのテキスト用形式にエンコ`ドします。
--
--   [引数]
--     str にはエンコ`ドしたい文字列を Shift_JIS で渡します。
--
--   [り]
--     encstr には
--     "533093306b3061306f30164e4c750000..."
--     のような文字列を返します。
--
-- encstr = GCMZDrops.encodeexotextutf8(str)
--
--   文字列を AviUtl の exo ファイルや exa ファイルで使われる
--   テキストオブジェクトのテキスト用形式にエンコ`ドします。
--
--   [引数]
--     str にはエンコ`ドしたい文字列を UTF-8 で渡します。
--
--   [り]
--     encstr には
--     "533093306b3061306f30164e4c750000..."
--     のような文字列を返します。
--
-- decstr = GCMZDrops.decodeexotextutf8(str)
--
--   AviUtl の exo ファイルや exa ファイルで使われる
--   テキストオブジェクトのテキスト用形式を UTF-8 文字列にデコ`ドします。
--
--   [引数]
--     str には
--     "533093306b3061306f30164e4c750000..."
--     のような文字列を渡します。
--
--   [り]
--     decstr にはデコ`ドされた UTF-8 文字列を返します。
--
-- encstr = GCMZDrops.encodeluastring(str)
--
--   文字列を Lua 上での文字列リテラルにQします。
--
--   [引数]
--     str にはエンコ`ドしたい文字列を渡します。
--
--   [り]
--     encstr には
--     '"C:\\Your\\File.png"'
--     のように特定の文字がエスケ`プされ
--     全体がダブルクォ`トで括られた文字列を返します。
--
-- enc = GCMZDrops.detectencoding(str)
--
--   str のエンコ`ディングを推yします。
--   このI理は_gに正_なを返すものではありません。
--   "utf16le" と "utf16be" は BOM があるrのみ返されます。
--
--   [引数]
--     str にはエンコ`ディングを{べたい文字列を指定します。
--
--   [り]
--     enc には以下ののいずれかを返します。
--       "sjis" - Shift_JIS
--       "eucjp" - EUC-JP
--       "iso2022jp" - ISO-2022-JP
--       "utf8" - UTF-8
--       "utf16le" - UTF-16LE
--       "utf16be" - UTF-16BE
--       "" - バイナリデ`タ、推y不明など
--
-- converted = GCMZDrops.convertencoding(str, from, to)
--
--   str のエンコ`ディングを from から to にQして返します。
--
--   [引数]
--     str にはエンコ`ディングをQしたい文字列を指定します。
--     from には str のF在のエンコ`ディングを "sjis" などの文字列かコ`ドペ`ジで指定します。
--     to には str のQ先のエンコ`ディングを "sjis" などの文字列かコ`ドペ`ジで指定します。
--     from が utf8 / utf16le / utf16be のときに BOM がある龊悉献拥膜顺去されます。
--
--   [り]
--     converted にはエンコ`ディングQ後の文字列を返します。
--
-- r, v = GCMZDrops.prompt(caption, value)
--
--   入力用のダイアログを出してユ`ザ`に入力を要求します。
--
--   [引数]
--     caption には何を入力するための入力冥胜韦を文字列で指定します。
--     value には入力冥衰钎榨━毳趣侨肓Δ筏皮く内容を文字列で指定します。
--
--   [り]
--     r には OK が押されたかどうかを返します。
--     v には入力された内容を文字列で返します。
--
-- r = GCMZDrops.confirm(caption)
--
--   _J用のダイアログを出して、ユ`ザ`に OK とキャンセルの判断を要求します。
--
--   [引数]
--     caption にはユ`ザ`にいかける内容を文字列で指定します。
--
--   [り]
--     r には OK が押されたかどうかを返します。
--
-- ini = GCMZDrops.inistring(str)
--
--   str を INI ファイルとして解析し、集用オブジェクトを返します。
--   AviUtl においては *.exo や *.exa をiみzんだりきQえたりする龊悉擞杏盲扦埂
--   INI ファイルについては Wikipedia 等を参照してください。
--
--   [引数]
--     str には INI ファイルの内容が格{された文字列を渡します。
--
--   [り]
--     ini には集用オブジェクトを返します。
--
--   [集用オブジェクトの使い方]
--     集用オブジェクトでは以下のメソッドが使用可能です。
--
--     v = ini:get("セクション", "キ`", "デフォルト")
--
--       セクションとキ`に辘筏を返します。
--       デ`タがつからなかった龊悉 "デフォルト" を返します。
--
--     ini:set("セクション", "キ`", "")
--
--       新しくをセットします。
--       セクションとキ`に辘工が既に存在する龊悉仙きされます。
--
--     ini:delete("セクション", "キ`")
--
--       セクションとキ`に辘筏を削除します。
--
--     ini:deletesection("セクション")
--
--       指定されたセクションを丸ごと削除します。
--
--     arr = ini:sections()
--
--       INI ファイルに存在する全てのセクションを配列で返します。
--
--     arr = ini:keys("セクション")
--
--       セクションに存在する全てのキ`を配列で返します。
--
--     found = ini:exists("セクション", "キ`")
--
--       指定されたセクションのキ`が存在するかどうかを真で返します。
--
--     found = ini:sectionexists("セクション")
--
--       指定されたセクションが存在するかどうかを真で返します。
--
--     tostring(ini)
--
--       内容を INI ファイルとして文字列で返します。
--
-- ini = GCMZDrops.inifile(filepath)
--
--   GCMZDrops.inistring とほぼ同じですが、文字列の代わりにファイルをiみzみます。
--
--   [引数]
--     str には INI ファイルへのパスを文字列で渡します。
--
--   [り]
--     ini には集用オブジェクトを返します。
--     使い方については GCMZDrops.inistring のh明を参照してください。
--
-- processed = GCMZDrops.drop(files, state)
--
--   集ウィンドウに向けて、指定されたデ`タをドロップします。
--   通常の用途ではこのI理を直接呼び出す必要はありません。
--
--   [引数]
--     files には以下のような配列（テ`ブル）を指定します。
--       files = {
--         {filepath="C:\Your\File.png"},
--         {filepath="C:\Your\File2.png"},
--         ...
--       }
--       [a足情]
--         files には配列（テ`ブル）で}数のファイルを指定できますが、
--         １つのファイルによりタイムライン上に}数のアイテムが追加される龊稀
--         そのファイル以降は正しくない位置にドロップされることがあります。
--         （例えば *.exo や踊をドロップした龊悉税k生します）
--
--     state には以下のようなテ`ブルを渡します。
--       state = {
--         -- ファイルをドロップするマウスカ`ソル位置
--         x=120,
--         y=235
--       }
--
--   [り]
--     processed はドロップI理がgHに行われたかどうかを返します。
--     ユ`ザ`によってキャンセルされるなど、何らかの原因で中断されることもあります。
--
-- files = GCMZDrops.getclipboard()
--
--   クリップボ`ドに入っているデ`タをiみ取ります。
--   iみ取りル`ルはドロップされたファイルにするものと同一です。
--
--   [引数]
--     引数はありません。
--
--   [り]
--     files には以下のような配列（テ`ブル）を返します。
--       files = {
--         {filepath="C:\Your\File.png"},
--         {filepath="C:\Your\File2.png"},
--         ...
--       }
--     ただし、何らかの理由でiみ取り自体に失・筏龊悉 nil を返します。
--
-- GCMZDrops.deleteonfinish(file)
--
--   ドラッグ＆ドロップI理が完了したrに削除すべきファイルを登hします。
--   通常の用途ではこのI理を呼び出す必要はありません。
--
--   [引数]
--     file にはドラッグ＆ドロップの完了rに削除したいファイル名を指定します。
--
--   [り]
--     りはありません。
--
-- GCMZDrops.deleteonabort(file)
--
--   I理中にスクリプトエラ`がk生したr、
--   およびドロップがキャンセルされたrに削除すべきファイルを登hします。
--   通常の用途ではこのI理を呼び出す必要はありません。
--
--   [引数]
--     file にはエラ`やキャンセルrに削除したいファイル名を指定します。
--
--   [り]
--     りはありません。
--
-- GCMZDrops.doevents(msgMin, msgMax)
--
--   g行がLrgに渡るスクリプトをg行するHに、
--   定期的に GCMZDrops.doevents(0, 0) を呼び出すと
--   AviUtl が「甏黏胜贰工摔胜毪韦蚧乇埭工毪长趣できます。
--
--   [引数]
--     msgMin, msgMax には一般的な用途では 0 を渡してください。
--
--   [り]
--     りはありません。
--

return P
